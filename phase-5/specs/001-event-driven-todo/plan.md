# Implementation Plan: Event-Driven Todo Chatbot System

**Branch**: `001-event-driven-todo` | **Date**: 2026-02-05 | **Spec**: [link](spec.md)
**Input**: Feature specification from `/specs/001-event-driven-todo/spec.md`

**Note**: This template is filled in by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

This plan describes the implementation of an event-driven Todo Chatbot system that demonstrates real-world distributed systems using Kafka, Kubernetes, and Dapr. Building upon the AI-powered todo chatbot from Phase 3 and the Kubernetes deployment strategies from Phase 4, this system transforms the monolithic architecture into a fully event-driven system. The system consists of multiple microservices that communicate via Kafka events, with a focus on asynchronous processing and loose coupling. The architecture includes a Chat API service, Recurring Task Service, Notification Service, Audit Service, and Real-Time Sync Service, all deployed on Kubernetes with Dapr used only for state and secret management.

## Technical Context

**Language/Version**: Python 3.11, Go 1.21
**Primary Dependencies**: FastAPI (from Phase 3), Kafka client libraries (confluent-kafka), Dapr SDK, Kubernetes client
**Storage**: PostgreSQL for primary task data (from Phase 3's Neon PostgreSQL), Kafka for event streaming, Redis for caching (via Dapr)
**Testing**: pytest for unit/integration tests, k6 for load testing
**Target Platform**: Linux containers orchestrated by Kubernetes (from Phase 4)
**Project Type**: Distributed microservices
**Performance Goals**: Handle 1000 concurrent users, process events with <5 second latency
**Constraints**: <200ms p95 API response time, <10MB memory per service, fault-tolerant operation
**Scale/Scope**: Support 10k users, 1M tasks, 5 services with independent scaling

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- ✅ Event-driven architecture implemented with Kafka as the backbone
- ✅ Dapr used only for state and secrets, not for pub/sub (complies with constitution)
- ✅ No manual coding - all artifacts generated by AI agents
- ✅ Architecture depth prioritized over UI completeness
- ✅ Services communicate via Kafka events, not direct calls
- ✅ System deployable on both Minikube and cloud Kubernetes (from Phase 4)
- ✅ Observability via structured logs with Kafka produce/consume events logged
- ✅ All advanced features (recurring tasks, due dates, reminders, etc.) emit Kafka events

## Project Structure

### Documentation (this feature)

```text
specs/001-event-driven-todo/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
# Multi-service microservices architecture
services/
├── chat-api/                 # Enhanced from Phase 3's AI chatbot backend
│   ├── src/
│   │   ├── models/          # SQLModel-based models (from Phase 3)
│   │   ├── services/        # Business logic layer
│   │   ├── api/             # FastAPI endpoints (from Phase 3)
│   │   ├── kafka/           # Event publishing logic
│   │   └── chat/            # Chat processing logic (from Phase 3)
│   ├── Dockerfile
│   ├── requirements.txt
│   └── tests/
├── recurring-task-service/   # New service for Phase 5
│   ├── src/
│   │   ├── consumers/       # Kafka event consumers
│   │   ├── processors/      # Recurring task logic
│   │   └── kafka/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── tests/
├── notification-service/     # New service for Phase 5
│   ├── src/
│   │   ├── consumers/       # Kafka event consumers
│   │   ├── notifiers/       # Notification logic
│   │   └── kafka/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── tests/
├── audit-service/            # New service for Phase 5
│   ├── src/
│   │   ├── consumers/       # Kafka event consumers
│   │   ├── storage/         # Audit log storage
│   │   └── kafka/
│   ├── Dockerfile
│   ├── requirements.txt
│   └── tests/
└── sync-service/             # New service for Phase 5
    ├── src/
    │   ├── consumers/       # Kafka event consumers
    │   ├── websocket/       # Real-time sync (enhanced from Phase 3)
    │   └── kafka/
    ├── Dockerfile
    ├── requirements.txt
    └── tests/

infrastructure/               # Enhanced from Phase 4
├── k8s/
│   ├── base/
│   ├── overlays/
│   │   ├── minikube/        # Config from Phase 4
│   │   └── cloud/           # Cloud deployment configs
│   └── components/
├── kafka/                    # New for Phase 5
│   ├── topics/
│   └── configs/
├── dapr/                     # New for Phase 5
│   └── components/
└── helm/
    └── todo-chatbot/

docker/
├── docker-compose.yml
└── networks/

scripts/                      # Enhanced from Phase 4
├── deploy-minikube.sh        # From Phase 4
├── deploy-cloud.sh
└── verify-system.sh

tests/
├── contract/
├── integration/
└── load/

ci/                           # Enhanced from Phase 4
└── github-actions/
    ├── build-workflow.yml
    └── deploy-workflow.yml
```

**Structure Decision**: Multi-service microservices architecture was selected to enable independent scaling and deployment of each service. Building upon the FastAPI and SQLModel foundation from Phase 3, and the Kubernetes deployment strategies from Phase 4, this architecture transforms the monolithic AI chatbot into an event-driven system. Each service has its own codebase with models, services, API/processing layers, and Kafka integration. Infrastructure is organized separately with Kubernetes manifests, Kafka configurations, Dapr components, and Helm charts for deployment. This structure supports the event-driven architecture required by the constitution.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| Multiple services | Event-driven architecture requires separation of concerns | Single monolithic service would violate event-driven principles | 
| Kafka infrastructure | Required by constitution as mandatory technology | Simpler in-memory queues forbidden by constitution |
| Dapr integration | Required by constitution for state/secrets management | Direct database access would not meet security requirements |
| Enhanced complexity | Building upon existing Phase 3 and 4 implementations | Starting from scratch would lose valuable functionality |
